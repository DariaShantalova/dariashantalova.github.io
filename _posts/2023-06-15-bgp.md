 # BGP
 - Only EGP in major use today.
 - Point-to-Poing Peering
 - Application Level Protocol
 - TCP (179)
 - Path Vector (not metric)
 
## BGP Path Attributes
* Well-Known, Mandatory (mandatory by RFC4271, will be included in every update)  
   * AS-Path
   * Next-Hop
   * Origin
Can be incomplete
* Well-Known, Discretionary (well-known: means industry standart, every router supports this attributes; Discretionary: means I am allowed not to use them; if I use then -> I pass them)
   * Local Preference
   * Atomic Aggregate
* Optional, Transitive (Optional: if you design software, you option add or not to add this attribute, you can also add proprietary attribute; Transitive: the attribute will be passed to another router)
   * Aggregator
   * Community 
* Optional, Non-Transitive
   * MED (Metric)
   * Originator ID
   * Cluster


Loop Prevention Mechanism: AS-PATH
Let the loop, as soon as it's duplicated AS - the route will be dropped.


## BGP Neighbors
There are 2 types of neighbors
* EBGP
 (between diffent AS)
* iBGP
 (between the same AS, if there is a need to distribute some routes in our network from internet)
 
 TCP - 179
 Simple communications:
 * OPEN - starts the session
 * KEEPALIVE - maintains the session (doesn't rely on tcp)
 * UPDATE - take some time, cause lot's updates are on the internet, shouldn't react immediately
 * NOTIFICATION - smth is broken, before to break the session
 * (Route Refresh - not in the original standart, updating routes without affecting peering)

 
 Neighbor can be not directly connected, can have neighbors on top of other routers.
 The more specific route beats everything.
 By getting some routes from iBGP we can choose more specific route.
 
 Before creating neighborship, you put all kind of filters, so the neighbor will not mess your routes. Same from other side.
 
 ## BGP Header
* Marker field - deprecated, field with all 1, was made fore synchronization beetwen peers and authentication, still there if there is an old bgp device
* Length
* Type - indicates of what type of bgp message we are dealing with
** 1 - open
** 2 - update
** 3 - notification
** 4 - keepalive
** 5 - route refresh behavior

<img width="594" alt="Screenshot 2023-06-16 at 15 06 27" src="https://github.com/DariaShantalova/dariashantalova.github.io/assets/34622678/8198b6e0-4b6e-49bd-809b-85a2be0bc37a">


### OPEN Message Format
* Version - we expect future versions of bgp
* My As
* Hold Time - 0 or at least 3 seconds, between two the lowest will be chossen
* BGP Identifier - bgp router id, distinguish your system uniquely in the bgp peering
* Optional Parameter Length
* Optional Parameters 

<img width="619" alt="Screenshot 2023-06-16 at 15 06 50" src="https://github.com/DariaShantalova/dariashantalova.github.io/assets/34622678/159b5aec-1548-4fca-ba85-07c37c69480e">



### BGP UPDATE Message Format
* Withdrawn routes length
* Withdrawn Routes
* Total Path Attribute Length
* Path Attributes
* NLRI

<img width="315" alt="Screenshot 2023-06-16 at 15 07 36" src="https://github.com/DariaShantalova/dariashantalova.github.io/assets/34622678/ff3984ce-d00b-49a5-b5ea-38395bcc75d2">


### BGP Keepalive Message (just header, no data)
* Marker
* Length
* Type

<img width="601" alt="Screenshot 2023-06-16 at 15 08 02" src="https://github.com/DariaShantalova/dariashantalova.github.io/assets/34622678/eb1cd362-5d25-48d8-94c5-16e709e0d81f">


### BGP Notification Message
* Error Code - general type of error
* Error Subcode
ex. 3 3 update message error, missing well-known attribute
* Data

<img width="606" alt="Screenshot 2023-06-16 at 15 08 15" src="https://github.com/DariaShantalova/dariashantalova.github.io/assets/34622678/0d3549e3-7f19-4da6-a60a-c70c4962b4b9">

 
  ##  BGP Neighbor Relationship Process (6 states)
 * Idle (neighbor configured, if stuck in idle chances are good that they can't reach each other, all roads lead to idle)
 * Connect ( trying to form TCP relationship, to check #show tcp br)
 * Active (also tcp)
 * OpenSent (BGP version, autonomous system is correct? , router id, passwords)
 * OpenConfirm (the open message comes back)
 * Established, number - represents how many prefixes it receives from other side, neighbor established


 ## BGP Best Path Algorithm , CISCO, BGP Decision path
Attributes
1. WEIGTH (Cisco Proprietary) - higher is better (example if route comes from big net, I want to put higher weight on this route then from the smaller net, using route map) , as it's chosen, will not look to other part of the list
2. Local Prefenrence - somethimg that travels through yours autonomous system
3. Locally Originated
4. Accumulated IGP (AIGP) - can take the metric of interior protocol
5. Shortest AS-PATH
6. Origin Type
7. Lowest multi-exit discriminator (MED/Metric)
8. eBGP over iBGP
9. Oldest route
10. Lowest Peer Router-Id
11. Lowesr Cluster List Length
12. Lowest Next Hop Address


 
 


