 # BGP
## BGP Path Attributes
* Well-Known, Mandatory (mandatory by RFC4271, will be included in every update)  
   * AS-Path
   * Next-Hop
   * Origin
Can be incomplete
* Well-Known, Discretionary (well-known: means industry standart, every router supports this attributes; Discretionary: means I am allowed not to use them; if I use then -> I pass them)
   * Local Preference
   * Atomic Aggregate
* Optional, Transitive (Optional: if you design software, you option add or not to add this attribute, you can also add proprietary attribute; Transitive: the attribute will be passed to another router)
   * Aggregator
   * Community 
* Optional, Non-Transitive
   * MED (Metric)
   * Originator ID
   * Cluster


Loop Prevention Mechanism: AS-PATH
Let the loop, as soon as it's duplicated AS - the route will be dropped.


## BGP Neighbors
There are 2 types of neighbors
* EBGP
 (between diffent AS)
* iBGP
 (between the same AS, if there is a need to distribute some routes in our network from internet)
 
 TCP - 179
 Simple communications:
 * OPEN - starts the session
 * KEEPALIVE - maintains the session (doesn't rely on tcp)
 * UPDATE - take some time, cause lot's updates are on the internet, shouldn't react immediately
 * NOTIFICATION - smth is broken, before to break the session

 
 Neighbor can be not directly connected, can have neighbors on top of other routers.
 The more specific route beats everything.
 By getting some routes from iBGP we can choose more specific route.
 
 Before creating neighborship, you put all kind of filters, so the neighbor will not mess your routes. Same from other side.
 
  ##  BGP Neighbor Relationship Process (6 states)
 * Idle (neighbor configured, if stuck in idle chances are good that they can't reach each other, all roads lead to idle)
 * Connect ( trying to form TCP relationship, to check #show tcp br)
 * Active (also tcp)
 * OpenSent (BGP version, autonomous system is correct? , router id, passwords)
 * OpenConfirm (the open message comes back)
 * Established, number - represents how many prefixes it receives from other side, neighbor established


 ## BGP Best Path Algorithm , CISCO, BGP Decision path
Attributes
1. WEIGTH (Cisco Proprietary) - higher is better (example if route comes from big net, I want to put higher weight on this route then from the smaller net, using route map) , as it's chosen, will not look to other part of the list
2. Local Prefenrence - somethimg that travels through yours autonomous system
3. Locally Originated
4. Accumulated IGP (AIGP) - can take the metric of interior protocol
5. Shortest AS-PATH
6. Origin Type
7. Lowest multi-exit discriminator (MED/Metric)
8. eBGP over iBGP
9. Oldest route
10. Lowest Peer Router-Id
11. Lowesr Cluster List Length
12. Lowest Next Hop Address


 
 


